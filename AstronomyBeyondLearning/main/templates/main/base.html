{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>
    {% block title %} ABL {% endblock title %}
    </title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    {% block extra_css %}{% endblock extra_css %}
</head>


<body>

    <nav class="glass-navbar no-reveal">

        <span class="menu-toggle material-icons" onclick="toggleMenu()">
            menu
        </span>

        <a href="{% url 'main:home' %}" class="glass-logo no-reveal">ABL</a>

        <div class="glass-center mobile-hidden no-reveal">

            <a href="{% url 'main:about_view' %}"
                class="{% if 'about' in request.path %}active-link{% endif %} no-reveal">
                About
            </a>

            <a href="{% url 'planets:planets_list' %}"
                class="{% if 'all/planets' in request.path %}active-link{% endif %} no-reveal">
                All Planets
            </a>

            <a href="{% url 'posts:all_posts' %}"
                class="{% if 'all/posts' in request.path %}active-link{% endif %} no-reveal">
                All Posts
            </a>

            {% if user.is_authenticated %}
            <a href="{% url 'posts:create_post' %}"
                class="{% if 'create/' in request.path %}active-link{% endif %} no-reveal">
                Add posts
            </a>
            {% endif %}

            {% if user.is_staff %}
            <a href="{% url 'planets:planets_add_view' %}"
                class="{% if 'add/' in request.path and 'planets' in request.path %}active-link{% endif %} no-reveal">
                Add planets
            </a>
            {% endif %}
            <a href="{% url 'games:game' %}"
                class="{% if 'games' in request.path %}active-link{% endif %} no-reveal">
                Games
            </a>

        </div>


        <div class="glass-right no-reveal">
            {% if user.is_authenticated %}

            <a href="{% url 'accounts:user_profile_view' user.username %}"
                class="welcome-text {% if user.username in request.path %}welcome-active{% endif %} no-reveal">
                <i class="material-icons">person</i>
                <span class="welcome-mobile">Welcome, {{ user.first_name|default:user.username }}</span>
            </a>

            <a href="{% url 'accounts:log_out' %}" class="glass-btn no-reveal">
                <i class="material-icons">logout</i>
            </a>

            {% else %}

            <a href="{% url 'accounts:sign_in' %}" class="glass-btn no-reveal">
                <i class="material-icons">login</i>
            </a>

            <a href="{% url 'accounts:sign_up' %}" class="glass-btn no-reveal">
                <i class="material-icons">person_add</i>
            </a>

            {% endif %}


            {% if user.is_staff %}
            <a href="{% url 'main:contact_messages' %}" class="glass-btn">
                <i class="material-icons no-reveal">mail</i>

                {% if unread_count > 0 %}
                <span class="msg-badge">{{ unread_count }}</span>
                {% endif %}
            </a>
            {% endif %}
        </div>
    </nav>


    <div class="glass-center-overlay" id="mobileMenu">
        <div class="glass-center-popup">

            <a href="{% url 'main:about_view' %}"
               class="{% if 'about' in request.path %}active-link{% endif %}">
               About
            </a>

            <a href="{% url 'planets:planets_list' %}"
               class="{% if 'all/planets' in request.path %}active-link{% endif %}">
               All Planets
            </a>

            <a href="{% url 'posts:all_posts' %}"
               class="{% if 'all/posts' in request.path %}active-link{% endif %}">
               All Posts
            </a>

            {% if user.is_authenticated %}
            <a href="{% url 'posts:create_post' %}"
               class="{% if 'create/' in request.path %}active-link{% endif %}">
               Add posts
            </a>
            {% endif %}

            {% if user.is_staff %}
            <a href="{% url 'planets:planets_add_view' %}"
               class="{% if 'add/' in request.path and 'planets' in request.path %}active-link{% endif %}">
               Add planets
            </a>
            {% endif %}

            <a href="{% url 'games:game' %}"
                class="{% if 'games' in request.path %}active-link{% endif %} no-reveal">
                Games
            </a>

        </div>
    </div>


    {% if latest_message %}
    <div class="new-msg-banner" id="msgBanner">
        <div class="banner-left">
            <span class="material-icons banner-icon no-reveal">mail</span>
            <div class="banner-text">
                <div>
                    New message from <strong>{{ latest_message.first_name }}</strong> — {{ latest_message.email }}
                </div>

                {% if unread_count > 1 %}
                <div class="new-msg-more">
                    +{{ unread_count|add:"-1" }} more unread messages
                </div>
                {% endif %}
            </div>
        </div>

        <button class="banner-dismiss" onclick="dismissBanner()">
            Dismiss <span class="material-icons">close</span>
        </button>
    </div>
    {% endif %}


    {% if messages %}
    <div class="messages">
        {% for msg in messages %}
        <p class="msg {{ msg.tags }}">{{ msg }}</p>
        {% endfor %}
    </div>
    {% endif %}


    <main>
        {% block content %}{% endblock content %}
    </main>


    <footer class="footer">
        <div class="footer-wrapper">
            <div class="footer-col site-name">
                <h4>ABL</h4>
                <p class="footer-subtitle">Astronomy Beyond Learning — Explore the universe.</p>
            </div>

            <div class="footer-col">
                <h4>Useful</h4>
                <a href="https://www.nasa.gov" target="_blank">NASA</a>
            </div>
        </div>

        <p class="footer-copy">© 2025 ABL — Astronomy Beyond Learning</p>
    </footer>


    {% block extra_js %}
    {% endblock extra_js %}

    <script src="{% static 'js/base.js' %}"></script>

</body>
</html>
